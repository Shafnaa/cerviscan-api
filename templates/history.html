{% extends 'base.html' %} {% block title %} History {% endblock %} {% block
content %}
<div class="page-container albums">
  <div class="albums-section">
    <h1>Albums</h1>
    <div class="search-container">
      <input
        type="text"
        class="search-bar"
        id="search-bar"
        placeholder="Search by patient name or date..."
        onkeyup="filterHistory()"
      />
    </div>

    {% for entry in history %}
    <a
      class="album-card"
      href="/history/{{ entry.id }}"
      data-name="{{ entry.name|lower }}"
      data-date="{{ entry.created_at.strftime('%Y-%m-%d') }}"
    >
      <div class="album-card-head">
        <p>{{ entry.name }}</p>
        <div class="tag date">
          <p>{{ entry.created_at.strftime('%Y-%m-%d') }}</p>
        </div>
      </div>
      <div class="album-card-foot">
        {% if entry.prediction %}
        <div class="tag abnormal"><p>Abnormal</p></div>
        {% else %}
        <div class="tag normal"><p>Normal</p></div>
        {% endif %}
        <form id="delete-{{ entry.id }}">
          <button type="submit" class="btn btn-danger">Delete</button>
        </form>
        <script>
          document
            .getElementById("delete-{{ entry.id }}")
            .addEventListener("submit", function (e) {
              e.preventDefault();
              if (confirmDelete()) {
                fetch("/api/record/{{ entry.id }}", {
                  method: "DELETE",
                  headers: {
                    Authorization: `Bearer ${localStorage.getItem(
                      "access_token"
                    )}`,
                  },
                })
                  .then((response) => {
                    if (response.ok) {
                      alert("Entry deleted successfully.");
                      location.reload();
                    } else {
                      alert("Failed to delete the entry.");
                    }
                  })
                  .catch((error) => {
                    console.error("Error:", error);
                    alert("An error occurred while deleting the entry.");
                  });
              }
            });
        </script>
      </div>
    </a>
    {% endfor %}
  </div>
</div>
<script>
  function filterHistory() {
    const searchInput = document
      .getElementById("search-bar")
      .value.toLowerCase();
    const cards = document.querySelectorAll(".album-card");

    cards.forEach((card) => {
      const name = card.getAttribute("data-name");
      const date = card.getAttribute("data-date");
      if (name.includes(searchInput) || date.includes(searchInput)) {
        card.style.display = "block";
      } else {
        card.style.display = "none";
      }
    });
  }

  function confirmDelete() {
    return confirm("Are you sure you want to delete this entry?");
  }
</script>
{% endblock %}
